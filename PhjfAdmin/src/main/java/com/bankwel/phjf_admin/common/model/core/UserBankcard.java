package com.bankwel.phjf_admin.common.model.core;

import com.bankwel.framework.core.F;
import com.bankwel.framework.core.kit.JFinalDbKit;
import com.bankwel.framework.core.kit.PageKit;
import com.bankwel.phjf_admin.common.constants.admin.AdminConstants;
import com.bankwel.phjf_admin.common.model.core.base.BaseUserBankcard;
import com.bankwel.phjf_baseModel.common.model.phjf.CacheUserBankcard;
import com.jfinal.plugin.activerecord.Db;
import com.jfinal.plugin.activerecord.Record;
import org.apache.commons.lang3.tuple.Pair;

import java.util.ArrayList;
import java.util.List;

/**
 * Generated by JFinal.
 */
@SuppressWarnings("serial")
public class UserBankcard extends CacheUserBankcard<UserBankcard> {
	public static final UserBankcard dao = new UserBankcard().dao();

	/**
	 * 查询
	 * @param mobilephone
	 * @param name
	 * @param page
	 * @return
	 */
	public Pair<List<Record>, PageKit<Record>> queryUserBankcardByPage(String bt_name, String mobilephone, String name, PageKit page){
		String sql = "select userInfo.true_name " +
				"            , userInfo.mobilephone " +
				"            , bankType.name bt_name " +
				"            , bankcard.bankcard_holder " +
				"            , bankcard.bankcard_no " +
				"            , bankcard.mobile " +
				"            , riskLevel.name risk_level_show " +
				"            , password.name is_password_show " +
				"            , status.name status_show " +
				"            , isShow.name is_show " +
				"       from phjf_user_bankcard bankcard " +
				"            left join phjf_bank_type bankType on bankType.bt_code = bankcard.bt_code and bankType.language = ? " +
				"            left join phjf_user_info userInfo on userInfo.user_id = bankcard.user_id " +
				"            left join sys_datalibrary riskLevel on riskLevel.parent_code = 'risk_level' and riskLevel.code = bankcard.risk_level " +
				"            left join sys_datalibrary password on password.parent_code = 'is_password' and password.code = bankcard.is_password " +
				"            left join sys_datalibrary status on status.parent_code = 'sys_status' and status.code = bankcard.status " +
				"            left join sys_datalibrary isShow on isShow.parent_code = 'sys_isShow' and isShow.code = bankcard.is_show " +
				"      where 1 = 1 ";
		List params = new ArrayList();
		params.add(AdminConstants.LanguageType.ZH_SIMP.value);
		if (F.validate.isNotEmpty(bt_name)){
			sql += " and (bankType.name like concat('%',?,'%') or bankType.bt_code = ?) ";
			params.add(bt_name);
			params.add(bt_name);
		}
		if (F.validate.isNotEmpty(mobilephone)){
			sql += " and userInfo.mobilephone = ? ";
			params.add(mobilephone);
		}
		if (F.validate.isNotEmpty(name)){
			sql += " and userInfo.true_name like concat('%',?,'%') ";
			params.add(name);
		}

		sql += " order by bankcard.create_time desc ";
		return JFinalDbKit.paginate(Db.use("DBPublic"), page.getNowPage(), page.getRowsPerPage(), sql, params.toArray());

	}
}
